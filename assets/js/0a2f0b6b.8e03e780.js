"use strict";(self.webpackChunkvre_hub=self.webpackChunkvre_hub||[]).push([[244],{2835:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>h});var r=t(4848),a=t(8453);const o={},c="Reana cluster",s={id:"reana",title:"Reana cluster",description:"Connect to the cluster by navigating here. You can use your X509 certificate to authenticate through IAM.",source:"@site/docs/reana.md",sourceDirName:".",slug:"/reana",permalink:"/vre-hub/docs/reana",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/reana.md",tags:[],version:"current",frontMatter:{},sidebar:"GetStarted",previous:{title:"Jupyterhub interface",permalink:"/vre-hub/docs/notebook"},next:{title:"The Rucio Data Lake",permalink:"/vre-hub/docs/rucio"}},i={},h=[{value:"Connect to a custom Rucio instance",id:"connect-to-a-custom-rucio-instance",level:3}];function l(e){const n={a:"a",code:"code",h1:"h1",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"reana-cluster",children:"Reana cluster"}),"\n",(0,r.jsxs)(n.p,{children:["Connect to the cluster by navigating ",(0,r.jsx)(n.a,{href:"https://reana-vre.cern.ch/",children:"here"}),". You can use your X509 certificate to authenticate through IAM.\nExplore Reana on the software's ",(0,r.jsx)(n.a,{href:"https://docs.reana.io/",children:"official documentation"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["You can find other examples of differen workflow languages on the ",(0,r.jsx)(n.a,{href:"https://docs.reana.io/advanced-usage/access-control/rucio/",children:"official Reana documentation"}),"."]}),"\n",(0,r.jsx)(n.h1,{id:"reana---rucio-integration",children:"Reana - Rucio integration"}),"\n",(0,r.jsxs)(n.p,{children:["A functionality to directly upload files from a Rucio RSE to the Reana workspace has been implemented. In this way, users can immediately reproduce an analysis on Reana without having to first download files locally from Rucio and then upload them to the Reana workspace.\nIn order to take advantage of this, follow ",(0,r.jsx)(n.a,{href:"https://docs.reana.io/advanced-usage/access-control/rucio/",children:"these"})," steps after having installed the ",(0,r.jsx)(n.a,{href:"https://docs.reana.io/getting-started/first-example/",children:"reana-client"}),"."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Execute from terminal:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="/src/components/HelloCodeTitle.js"',children:"$ export REANA_SERVER_URL=https://reana-vre.cern.ch\n$ export REANA_ACCESS_TOKEN=xxxxxxxxxxxxxxxxxxx\n$ reana-client secrets-add --env VONAME=escape \\\n                           --env VOMSPROXY_FILE=x509up_u1000 \\\n                           --file /tmp/x509up_u1000 \\\n                           --env RUCIO_USERNAME=<your_rucio_username> \\\n                           --env RUCIO_RUCIO_HOST=https://vre-rucio.cern.ch \\\n                           --env RUCIO_AUTH_HOST=https://vre-rucio-auth.cern.ch\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The VOMSPROXY_FILE is the temporary file that you need to generate after having split the x509 into ",(0,r.jsx)(n.code,{children:"client.crt"})," and ",(0,r.jsx)(n.code,{children:"client.key"}),". Execute: with the command:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ voms-proxy-init --voms escape --cert /opt/rucio/etc/client.crt --key /opt/rucio/etc/client.key\n"})}),"\n",(0,r.jsxs)(n.p,{children:["and note where the proxy file gets saved, the default path should be ",(0,r.jsx)(n.code,{children:"/tmp/x509up_u1000"}),"."]}),"\n",(0,r.jsx)(n.h3,{id:"connect-to-a-custom-rucio-instance",children:"Connect to a custom Rucio instance"}),"\n",(0,r.jsxs)(n.p,{children:["The VRE Rucio instance is only one of the many instances existing around the world. In order to connect to a custom Rucio instance, you need an x509 certificate to use with the VOMS of your organisation. Once you have it, you can import it in the ",(0,r.jsx)(n.a,{href:"https://jhub-vre.cern.ch",children:"jhub-vre.cern.ch"}),". You can then run the ",(0,r.jsx)(n.code,{children:"voms-proxy-init"})," with any VO by first sourcing the CVMFS file:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ source /cvmfs/grid.cern.ch/centos7-ui-160522/etc/profile.d/setup-c7-ui-example.sh \n"})}),"\n",(0,r.jsx)(n.p,{children:"Now, based on your VO organisation, run (for example, if you are part of ATLAS):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ voms-proxy-init --voms atlas --cert /opt/rucio/etc/client.crt --key /opt/rucio/etc/client.key\n"})}),"\n",(0,r.jsxs)(n.p,{children:["And then, the appropriate secrets for the ",(0,r.jsx)(n.code,{children:"reana-client"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ reana-client secrets-add --env VONAME=atlas \\\n                           --env VOMSPROXY_FILE=x509up_u1000 \\\n                           --file /tmp/x509up_u1000 \\\n                           --env RUCIO_USERNAME=<your_rucio_username>\n                           --env RUCIO_RUCIO_HOST=https://voatlasrucio-server-prod.cern.ch \\\n                           --env RUCIO_AUTH_HOST=https://voatlasrucio-auth-prod.cern.ch\n"})}),"\n",(0,r.jsx)(n.h1,{id:"dispatch-the-workflow",children:"Dispatch the workflow"}),"\n",(0,r.jsxs)(n.p,{children:["Move to the directory where you have your ",(0,r.jsx)(n.strong,{children:"reana.yaml"})," file, which should follow this template (with Rucio and ESCAPE VOMS set to true):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"version: 0.6.0\nworkflow:\n  type: serial\n  specification:\n    steps:\n      - name: fetchdata\n        voms_proxy: true\n        rucio: true\n        environment: 'ghcr.io/vre-hub/vre-rucio-client:v0.1.2-1-0487cc0'\n        commands:\n        - rucio get <SCOPE_NAME:FILE_NAME>\n      - name: fitdata\n        environment: <link_to_github_registry_or_dockerhub_image>\n        commands:\n        - <your_commands>\n      - name: uploaddata\n        voms_proxy: true\n        rucio: true\n        environment: 'ghcr.io/vre-hub/vre-rucio-client:v0.1.2-1-0487cc0'\n        commands:\n        - rucio upload --scope SCOPE_NAME --rse RSE_NAME <your_result_named_as_ProjectType.DataDescription.DataType>\n"})}),"\n",(0,r.jsxs)(n.p,{children:["WARNING: note that the ",(0,r.jsx)(n.code,{children:"rucio get"})," command creates a directory named after the scope_name and places the files you are looking for inside it."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Execute:"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"$ reana-client create -w <name_of_your_workflow>\n$ export REANA_WORKON=<name_of_your_workflow>\n$ reana-client upload         \n$ reana-client start      \n$ reana-client status\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"5",children:["\n",(0,r.jsxs)(n.li,{children:["Check the state of your workflow on ",(0,r.jsx)(n.a,{href:"https://reana-vre.cern.ch/",children:"https://reana-vre.cern.ch/"}),"."]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>s});var r=t(6540);const a={},o=r.createContext(a);function c(e){const n=r.useContext(o);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:c(e.components),r.createElement(o.Provider,{value:n},e.children)}}}]);