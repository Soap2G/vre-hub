"use strict";(self.webpackChunkvre_hub=self.webpackChunkvre_hub||[]).push([[111],{9892:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var i=t(4848),r=t(8453);const o={},a="The Rucio Data Lake",c={id:"rucio",title:"The Rucio Data Lake",description:"The Data Lake infrastructure is made up of distributed Storage Elements and of a reliable framework to upload and transfer data between them.",source:"@site/docs/rucio.md",sourceDirName:".",slug:"/rucio",permalink:"/vre-hub/docs/rucio",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/rucio.md",tags:[],version:"current",frontMatter:{},sidebar:"GetStarted",previous:{title:"Reana cluster",permalink:"/vre-hub/docs/reana"}},s={},l=[{value:"X509 Rucio configuration",id:"x509-rucio-configuration",level:3},{value:"OIDC token Rucio configuration",id:"oidc-token-rucio-configuration",level:3},{value:"1. Manual installation",id:"1-manual-installation",level:2},{value:"2. Docker image installation",id:"2-docker-image-installation",level:2},{value:"a. Run with X.509 authentication",id:"a-run-with-x509-authentication",level:3},{value:"b. Run with token authentication",id:"b-run-with-token-authentication",level:2},{value:"c. Run with userpass authentication",id:"c-run-with-userpass-authentication",level:2},{value:"Uploading data on the Data Lake",id:"uploading-data-on-the-data-lake",level:2},{value:"Rucio RESTful APIs",id:"rucio-restful-apis",level:2},{value:"<em>Token generation</em>",id:"token-generation",level:4},{value:"<em>Proxy generation</em>",id:"proxy-generation",level:4}];function d(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"the-rucio-data-lake",children:"The Rucio Data Lake"}),"\n",(0,i.jsxs)(n.p,{children:["The Data Lake infrastructure is made up of distributed Storage Elements and of a reliable framework to upload and transfer data between them.\nAn overview of the available Rucio Storage Elements (RSEs) can be found in the ",(0,i.jsx)(n.a,{href:"https://monit-grafana-open.cern.ch/d/PJ65OqBVz/vre-rucio-events?orgId=16",children:"Grafana monitoring dashboard"}),", which are useful to inspect the RSE transfer details."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"image",src:t(3968).A+"",width:"1321",height:"505"})}),"\n",(0,i.jsxs)(n.p,{children:["If you do not have access to the dashboard, register with a CERN SSO account, please get in touch through the ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"https://eosc-escape.slack.com/archives/C03Q65M1U5V",children:"Slack channel"})}),".\nThe location of the storage elements, which are provided and maintained by European partner institutions, is shown on the map, and a list of them is reported in the table."]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:(0,i.jsx)(n.em,{children:"Rucio Storage Element (site-technology)"})}),(0,i.jsx)(n.th,{children:"Location"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"CC_DCACHE"})}),(0,i.jsx)(n.td,{children:"Centre de Calcul, (IN2P3), Lyon, FR"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"CERN-EOS"})}),(0,i.jsx)(n.td,{children:"European Organization for Nuclear Research, Meyrin, CH"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"CESNET-S3"})}),(0,i.jsx)(n.td,{children:"Czech Education and Scientific NETwork, Prague, CZ"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"CNAF-STORM"})}),(0,i.jsx)(n.td,{children:"Istituto Nazionale di Fisica Nucleare, Bologna, IT"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"DESY-DCACHE"})}),(0,i.jsx)(n.td,{children:"Deutsches Elektronen-Synchrotron, Hamburg, DE"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"IN2P3_LAPP-DCACHE"})}),(0,i.jsx)(n.td,{children:"Laboratoire d'Annecy de Physique des Particules (CNRS/IN2P3), Annecy, FR"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"INFN_NAPOLI-DCACHE"})}),(0,i.jsx)(n.td,{children:"Istituto Nazionale di Fisica Nucleare, Napoli, IT"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"PIC-DCACHE"})}),(0,i.jsx)(n.td,{children:"Port d\u2019Informaci\xf3 Cient\xedfica, Barcelona, ES"})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{alt:"image",src:t(6112).A+"",width:"541",height:"697"})}),"\n",(0,i.jsx)(n.p,{children:"This guide takes a look at how to install the Rucio client environment in two different ways."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Installing the required packages on your local machine."}),"\n",(0,i.jsx)(n.li,{children:"Using a Docker container. Docker technologies mitigate dependency and platform specific issues, and are therefore recommended; however, if you want to upload large data that are present on your system, you will need to copy them inside the Docker container, and then upload them on the Rucio Data Lake. This might be cumbersome, especially if you are dealing with large files."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"In general, there are two main ways to authenticate to the Rucio instance: via X509 certificates and via OIDC tokens. These two ways require different configuration files for Rucio."}),"\n",(0,i.jsx)(n.h3,{id:"x509-rucio-configuration",children:"X509 Rucio configuration"}),"\n",(0,i.jsxs)(n.p,{children:["The X509 certificate is placed in the ",(0,i.jsx)(n.code,{children:".globus/"})," directory.\nThe ",(0,i.jsx)(n.code,{children:"rucio.cfg"})," file is usually placed in the ",(0,i.jsx)(n.code,{children:"/opt/rucio/etc/"})," directory."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"[client]\nrucio_host = https://vre-rucio.cern.ch\nauth_host = https://vre-rucio-auth.cern.ch\nca_cert = /etc/pki/tls/certs/CERN-bundle.pem\nauth_type = x509_proxy\naccount = <myrucioaccount>\nclient_cert = .globus/usercert.pem\nclient_key = .globus/userkey.pem\nclient_x509_proxy = /tmp/x509up_u0 #(or check where the voms-proxy-init command saves the proxy file!)\n\n[policy]\npermission = escape \nschema = escape  \nlfn2pfn_algorithm_default = hash \nsupport = https://github.com/rucio/rucio/issues/\nsupport_rucio = https://github.com/rucio/rucio/issues/\n"})}),"\n",(0,i.jsx)(n.h3,{id:"oidc-token-rucio-configuration",children:"OIDC token Rucio configuration"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"rucio.cfg"})," file is usually placed in the ",(0,i.jsx)(n.code,{children:"/opt/rucio/etc/"})," directory."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"[client]\nrucio_host = https://vre-rucio.cern.ch\nauth_host = https://vre-rucio-auth.cern.ch\nca_cert = /etc/pki/tls/certs/CERN-bundle.pem\nauth_type = oidc\naccount = <myrucioaccount>\noidc_audience = rucio\noidc_scope = openid profile offline_access wlcg wlcg.groups fts:submit-transfer\nrequest_retries = 3\noidc_issuer = escape\noidc_polling = true\nauth_oidc_refresh_activate = true\n\n[policy]\npermission = escape \nschema = escape  \nlfn2pfn_algorithm_default = hash \n"})}),"\n",(0,i.jsx)(n.h2,{id:"1-manual-installation",children:"1. Manual installation"}),"\n",(0,i.jsxs)(n.p,{children:["We assume you are running the commands from a CentOS Linux distribution, in our case a ",(0,i.jsx)(n.code,{children:"CS8 - x86_64"})," image. Run the commands in the following order:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"yum install -y epel-release.noarch && \\\n    yum clean all && \\\n    rm -rf /var/cache/yum\n    \nyum upgrade -y && \\\n    yum clean all && \\\n    rm -rf /var/cache/yum\n    \nyum -y install wget gfal2*\n\nyum -y install https://repo.ius.io/ius-release-el7.rpm && \\\n    yum install -y voms-clients-java gfal2-all gfal2-util python3-gfal2 xrootd-client\\\n                   nordugrid-arc-client nordugrid-arc-plugins-gfal \\\n                   nordugrid-arc-plugins-globus nordugrid-arc-plugins-s3 \\\n                   nordugrid-arc-plugins-xrootd && \\\n    yum clean all && \\\n    rm -rf /var/cache/yum\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"Then, install the certificates for the VOMS validation:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -Lo /etc/yum.repos.d/EGI-trustanchors.repo https://repository.egi.eu/sw/production/cas/1/current/repo-files/EGI-trustanchors.repo && yum -y update && yum -y install ca-certificates ca-policy-egi-core fetch-crl && yum clean all && rm -rf /var/cache/yum\n\ncurl -Lo /etc/pki/tls/certs/CERN-bundle.pem https://gitlab.cern.ch/plove/rucio/-/raw/7121c7200257a4c537b56ce6e7e438f0b35c6e48/etc/web/CERN-bundle.pem\n\nmkdir -p /etc/vomses \\\n    && wget https://indigo-iam.github.io/escape-docs/voms-config/voms-escape.cloud.cnaf.infn.it.vomses -O /etc/vomses/voms-escape.cloud.cnaf.infn.it.vomses\nmkdir -p /etc/grid-security/vomsdir/escape \\\n    && wget https://indigo-iam.github.io/escape-docs/voms-config/voms-escape.cloud.cnaf.infn.it.lsc -O /etc/grid-security/vomsdir/escape/voms-escape.cloud.cnaf.infn.it.lsc\n"})}),"\n",(0,i.jsx)(n.p,{children:"Next, you need the python rucio-client. We suggest to do this in a fresh virtual environment."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Latest version of Rucio \nexport RUCIO_LATEST=1.30.0\n\npython3 -m pip install --user virtualenv\npython3 -m venv rucio --system-site-packages\nsource rucio/bin/activate\npython3.6 -m pip install --no-cache-dir --upgrade pip && \\\npython3.6 -m pip install  --no-cache-dir --upgrade setuptools && \\\npython3.6 -m pip install --no-cache-dir --pre rucio-clients==${RUCIO_LATEST} && \\\npython3.6 -m pip install --no-cache-dir jinja2 j2cli pyyaml\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Have your ",(0,i.jsx)(n.code,{children:"rucio.cfg"})," file ready in ",(0,i.jsx)(n.code,{children:"/opt/rucio/etc/"})," and run:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export RUCIO_CONFIG=/opt/rucio/etc/rucio.cfg\n"})}),"\n",(0,i.jsx)(n.p,{children:"If you use X509 verification, you will also need the command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"voms-proxy-init --voms escape --cert .globus/usercert.pem --key .globus/userkey.pem \n"})}),"\n",(0,i.jsx)(n.p,{children:"Otherwise, if you use tokens, you are good to go."}),"\n",(0,i.jsx)(n.p,{children:"By typing in the terminal:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ rucio whoami\n"})}),"\n",(0,i.jsxs)(n.p,{children:["you should see your username being recognised. If it is your first time using tokens, you will be redirected to a link starting with  '",(0,i.jsx)(n.a,{href:"https://escape-rucio-auth.cern.ch/auth/",children:"https://escape-rucio-auth.cern.ch/auth/"}),"...'; click on it and choose the duration of your token. You should be all set up to run your rucio commands!"]}),"\n",(0,i.jsx)(n.h2,{id:"2-docker-image-installation",children:"2. Docker image installation"}),"\n",(0,i.jsxs)(n.p,{children:["Docker needs to be installed following the ",(0,i.jsx)(n.a,{href:"https://docs.docker.com/get-docker/",children:"Docker installation"})," instructions. The procedure will change depending on your operating system.\nThe Docker file will extend the Rucio image and will enable the user to interact with the Data Lake. Further information can be found ",(0,i.jsx)(n.a,{href:"https://github.com/vre-hub/vre/blob/main/containers/rucio-client",children:"here"}),".\nThe Docker image for this project can be pulled with:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ docker pull ghcr.io/vre-hub/vre-rucio-client:latest\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The image is hosted ",(0,i.jsx)(n.a,{href:"https://github.com/vre-hub/vre/pkgs/container/vre-rucio-client",children:"here"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["A default Rucio ",(0,i.jsx)(n.code,{children:"/opt/rucio/etc/rucio.cfg"})," file is incorporated into the image and supplied to the container when it is run. The values from this default can be partially or fully overridden by either specifying parameters as environment variables or by mounting a bespoke configuration file."]}),"\n",(0,i.jsx)(n.p,{children:"The -v option is a volume mount, which mounts your certificates from your local directory into the docker container.\nMake sure to specify the correct origin folder for the certificates, otherwise the command will generate an empty directory inside the container!"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"To UPLOAD data from the local machine where the Docker container is running to the Rucio Data Lake, you will need to add that directory as a volume mount (with the -v tag) to the container for it to be accessible inside the container. Follow the commands that below."})}),"\n",(0,i.jsxs)(n.p,{children:["To see whether you initialized the Docker container correctly, refer to the ",(0,i.jsx)(n.a,{href:"https://docs.docker.com/get-started/",children:"Docker documentation"}),". For example, you could run:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ docker ps -a\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The command should show the ",(0,i.jsx)(n.code,{children:"rucio-client"})," container running."]}),"\n",(0,i.jsx)(n.h3,{id:"a-run-with-x509-authentication",children:"a. Run with X.509 authentication"}),"\n",(0,i.jsx)(n.p,{children:"Have your certificate ready and divided into two files named ~/.globus/userkey.pem and ~/.globus/usercert.pem."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"docker run --user root -e RUCIO_CFG_CLIENT_X509_PROXY=/tmp/x509up -e RUCIO_CFG_AUTH_TYPE=x509_proxy -e RUCIO_CFG_ACCOUNT=<myrucioname> -v ~/.globus/usercert.pem:/opt/rucio/etc/client.crt -v ~/.globus/userkey.pem:/opt/rucio/etc/client.key -v ./<path_to_local_data_directory>:/home/<path_to_local_data_directory> -it --name=rucio-client ghcr.io/vre-hub/vre-rucio-client\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Take the ",(0,i.jsx)(n.code,{children:"--user root"})," option away if you encounter problems.\nIf you cannot log in as root and you get permission errors, add your user account to the docker group:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ sudo groupadd docker\n$ sudo gpasswd -a $USER docker\n"})}),"\n",(0,i.jsx)(n.p,{children:"Sometimes you will still need to give the /var/run/docker.sock socket and /var/run/docker directory the proper permissions to make it work:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ sudo chown root:docker /var/run/docker.sock\n$ sudo chown -R root:docker /var/run/docker\n"})}),"\n",(0,i.jsx)(n.p,{children:"Once you are inside the container, generate the proxy:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"$ voms-proxy-init --voms escape --cert /opt/rucio/etc/client.crt --key /opt/rucio/etc/client.key --out /tmp/x509up --debug\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Without the above command you will not be able to execute uploads and downloads!"})}),"\n",(0,i.jsxs)(n.p,{children:["After having run it, run ",(0,i.jsx)(n.code,{children:"rucio whoami"})," to check you are authenticated against the server."]}),"\n",(0,i.jsx)(n.h2,{id:"b-run-with-token-authentication",children:"b. Run with token authentication"}),"\n",(0,i.jsx)(n.p,{children:"You only need to run the container specifying that you want to be authenticated with tokens. You will need to click on a link that authenticates you against the server and you are set to go."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"docker run --user root -e RUCIO_CFG_AUTH_TYPE=oidc -e RUCIO_CFG_ACCOUNT=<myrucioname> -v ./<path_to_local_data_directory>:/home/<path_to_local_data_directory> -it --name=rucio-client ghcr.io/vre-hub/vre-rucio-client\n"})}),"\n",(0,i.jsx)(n.h2,{id:"c-run-with-userpass-authentication",children:"c. Run with userpass authentication"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ docker run -e RUCIO_CFG_ACCOUNT=<myrucioaccount> -e RUCIO_CFG_AUTH_TYPE=userpass -e RUCIO_CFG_USERNAME=<myrucioname> -e RUCIO_CFG_PASSWORD=<myruciopassword> -v ./<path_to_local_data_directory>:/home/<path_to_local_data_directory> -it --name=rucio-client ghcr.io/vre-hub/vre-rucio-client\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"General note:"})," To access the rucio-client Docker container in the future, always use this command from the machine where you have Docker installed:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ sudo docker exec -it rucio-client /bin/bash\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Take a look at some ",(0,i.jsx)(n.a,{href:"https://docs.google.com/document/d/1LKJu56VMg7jkh19BtWoS3xSNYPf_kJN2xRKQrankfB8/edit#heading=h.avprao92dhlc",children:"Rucio CLI Quickstart commands"})," to get you familiarised with the main concepts."]}),"\n",(0,i.jsx)(n.h2,{id:"uploading-data-on-the-data-lake",children:"Uploading data on the Data Lake"}),"\n",(0,i.jsx)(n.p,{children:"In order to uplaod data on the Data Lake, and supposing that you want to organise your data into data sets, you will need to choose an RSE (Rucio Storage Element), a Scope name and a Dataset name."}),"\n",(0,i.jsxs)(n.p,{children:["The Scope name follows the formatting ",(0,i.jsx)(n.em,{children:"Experiment_Institute_Project"})," (e.g. ATLAS_LAPP_SP, the EOSC-Future Science Project)\nThe Dataset name follows the formatting ",(0,i.jsx)(n.em,{children:"ProjectType.DataDescription.DataType"})," (DM.LeptonResonance.Data20015_10TeV, the ProjectType for EOSC-Future is either DM or EU)."]}),"\n",(0,i.jsx)(n.p,{children:"You can list the current scopes with:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"rucio list-scopes\n"})}),"\n",(0,i.jsx)(n.p,{children:"The current ones are:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsxs)(n.th,{children:["SCOPE (",(0,i.jsx)(n.em,{children:"Experiment_Institute_Project"}),")"]}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"test"})}),(0,i.jsx)(n.td,{children:"for the admins of the cluster"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"ET_OSB_MDC1"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.em,{children:"Einstein Telescope_Observational Science Board_Mock Data Challenge 1"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"CMS_CERN_AGC"})}),(0,i.jsx)(n.td,{children:"_Analysis Grand Challenge on CMS data _"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"ATLAS_LAPP_SP"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.em,{children:"ATLAS_Laboratoire d'Annecy de Physique des Particules_ScienceProject"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"KM3NET_ECAP_SP"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.em,{children:"Cubic Kilometre Neutrino Telescope_Erlangen Centre for Astroparticle Physics_ScienceProject"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"EGO_INFN_GW"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.em,{children:"European Gravitational Observatory_Istituto Nazionale Fisica Nucleare_Gravitational Waves"})})]})]})]}),"\n",(0,i.jsx)(n.p,{children:"To add a scope, you need to have administrator rights. If you don't have them, ask the system administrators to create a scope for you."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ rucio-admin scope add --account=<your_IAM_account_name> --scope <Experiment_Institute_Project>\n$ rucio-admin scope list\n"})}),"\n",(0,i.jsx)(n.p,{children:"You can list the available RSEs distributed across Europe with:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"rucio list-rses\n"})}),"\n",(0,i.jsx)(n.p,{children:"You can either upload single files, create a dataset, and attach the files to the dataset, or you can directly upload your folder (and the command will automatically create a dataset):"}),"\n",(0,i.jsx)(n.p,{children:"Example of how to upload single files to the CERN RSE:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ rucio upload --register-after-upload --scope ATLAS_LAPP_SP --rse CERN-EOS DM.LeptonResonance.Data20015_10TeV.root\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"--register-after-upload"})," flag is important; if you omit it and the upload fails, you will not be able to use the same file name to upload it, you will have to rename it."]}),"\n",(0,i.jsx)(n.p,{children:"Example of how to create a dataset:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ rucio add-dataset ATLAS_LAPP_SP:DM.LeptonResonance.Data20015_10TeV\n"})}),"\n",(0,i.jsx)(n.p,{children:"Example of how to attach files to your dataset:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ rucio attach ATLAS_LAPP_SP:DM.LeptonResonance.Data20015_10TeV ATLAS_LAPP_SP:DM.LeptonResonance.Data20015_10TeV.root\n"})}),"\n",(0,i.jsx)(n.p,{children:"Example of how to upload a whole file folder (cannot contain a folder within it):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ rucio -v upload --register-after-upload --rse CERN-EOS --scope ATLAS_LAPP_SP --recursive ./folder_name/\n"})}),"\n",(0,i.jsx)(n.p,{children:"To inspect all the datasets within a scope:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ rucio list-dids --filter 'type=all' ATLAS_LAPP_SP:*\n"})}),"\n",(0,i.jsx)(n.p,{children:"To display changes of files within one dataset:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ rucio list-files ATLAS_LAPP_SP:DM.LeptonResonance.Data20015_10TeV\n"})}),"\n",(0,i.jsx)(n.p,{children:"To see which rule protects your files:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ rucio list-rules --account=<your_account>\n"})}),"\n",(0,i.jsx)(n.p,{children:"To delete the files, either set a --lifetime flag when you upload data, or delete the replication rules associated to the data (the expiration wil be set in 1 hr time):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ rucio delete-rule --purge-replicas --all rule_id\n"})}),"\n",(0,i.jsx)(n.p,{children:"To add and look for metadata associated to a file or data set:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ rucio set-metadata --did ATLAS_LAPP_SP:DM.LeptonResonance.Data20015_10TeV --key KEY --value VALUE\n$ rucio get-metadata --plugin JSON ATLAS_LAPP_SP:DM.LeptonResonance.Data20015_10TeV\n$ rucio list-dids-extended --filter 'type=all' --filter 'KEY=VALUE' ATLAS_LAPP_SP:*\n"})}),"\n",(0,i.jsxs)(n.p,{children:["DO NOT use the value True or False for the ",(0,i.jsx)(n.em,{children:"VALUE"})," variable, as this will not be recognised by Rucio."]}),"\n",(0,i.jsx)(n.p,{children:"You should keep in mind that the scope will not get deleted from the Rucio memory."}),"\n",(0,i.jsxs)(n.p,{children:["You can visualize which data and rules are associated to your account by navigating to the ",(0,i.jsx)(n.a,{href:"https://vre-rucio-ui.cern.ch",children:"Rucio UI"})," platform."]}),"\n",(0,i.jsxs)(n.p,{children:["Have a look at the ",(0,i.jsx)(n.a,{href:"https://rucio.readthedocs.io/en/latest/man/rucio.html",children:"rucio client documentation"})," to perform more actions on your recently uploaded data.\nYou can also upload your data in a more user-friendly way using the [Jupyterhub interface](notebook.md###1. File Browser)."]}),"\n",(0,i.jsx)(n.h2,{id:"rucio-restful-apis",children:"Rucio RESTful APIs"}),"\n",(0,i.jsx)(n.p,{children:"Interacting with the client environment can be done through the Docker container, or through the RestAPI. This is a way for developers to be able to integrate any kind of scripts into the environment without the need of installing all the Rucio CLI dependencies."}),"\n",(0,i.jsx)(n.h4,{id:"token-generation",children:(0,i.jsx)(n.em,{children:"Token generation"})}),"\n",(0,i.jsx)(n.p,{children:"Now that you have the VOMS in place, you will just need to add your token, which will expire and will be regenerated every hour, to your Rest API request.\nTo get the token, run the command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ curl -i --key ~/.globus/userkey.pem --cert ~/.globus/usercert.pem -H \"X-Rucio-Account: <myrucioaccount>\" -X GET https://vre-rucio-auth.cern.ch/auth/x509 | sed -n -e 's/^.*X-Rucio-Auth-Token: //p'\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The < myrucioaccount > instance needs to be replaced with your Rucio UI account name, the same as your IAM account (but you can also find it by navigating ",(0,i.jsx)(n.a,{href:"https://vre-rucio-ui.cern.ch/",children:"here"})," and selecting the \u2018Account management\u2019 option under the Admin scroll-down menu)."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"Note: Using curl with the --insecure option allows curl to make insecure connections (i.e. curl does not verify the certificate), bypassing: curl: (60) SSL certificate problem: self signed certificate in certificate chain."})}),"\n",(0,i.jsx)(n.p,{children:"Create a variable by copying the token which has been generated and running in the command line:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'$ token="<your_token>"\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Do not forget the ",(0,i.jsx)(n.code,{children:"\u201c"})," symbol."]}),"\n",(0,i.jsx)(n.p,{children:"After the token has been saved, you can run any Rest Api command, for example listing all the available RSEs or all the scopes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'$ curl -X GET -H "X-Rucio-Auth-Token: $token" https://vre-rucio.cern.ch/rses/\n$ curl -X GET -H "X-Rucio-Auth-Token: $token" https://vre-rucio.cern.ch/scopes/\n'})}),"\n",(0,i.jsx)(n.h4,{id:"proxy-generation",children:(0,i.jsx)(n.em,{children:"Proxy generation"})}),"\n",(0,i.jsx)(n.p,{children:"The proxy generation with the x509 certificate works in the same way, the only difference is the command to get the token:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"$ curl -i --key ~/.globus/userkey.pem --cert ~/.globus/usercert.pem -H \"X-Rucio-Account: <myrucioaccount>\" -X GET https://vre-rucio-auth.cern.ch/auth/x509_proxy | sed -n -e 's/^.*X-Rucio-Auth-Token: //p'\n"})}),"\n",(0,i.jsx)(n.p,{children:"Again, using curl with the --insecure option might be useful. Follow the same steps as above to make Rest API requests."}),"\n",(0,i.jsxs)(n.p,{children:["To find all the Rucio REST API commands, navigate ",(0,i.jsx)(n.a,{href:"https://rucio.github.io/documentation/html/rest_api_doc.html",children:"here"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},3968:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/monit-edcc60ef97ff410fc63ead69b0675e1f.png"},6112:(e,n,t)=>{t.d(n,{A:()=>i});const i=t.p+"assets/images/rses-ac5ac94aadda28e564ecb0c9c9b10007.png"},8453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>c});var i=t(6540);const r={},o=i.createContext(r);function a(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);